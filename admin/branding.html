<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ブランディング設定 - 管理</title>
  <link rel="stylesheet" href="admin-styles.css">
  <style>
    h2 { margin-top: 28px; }
    h3 { margin: 18px 0 6px; font-size: 16px; color: #374151; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 720px){ .two-col{ grid-template-columns: 1fr; } }
  </style>
  </head>
<body>
  <div class="header">
    <h1>ブランディング設定</h1>
    <div>
      <a href="dashboard.html"><button>ダッシュボード</button></a>
      <a href="settings.html"><button class="btn-ghost">サイト設定</button></a>
      <button id="logout-button">ログアウト</button>
    </div>
  </div>

  <div class="container">
    <form id="branding-form">
      <h2>団章・各隊ロゴ URL</h2>
      <div class="form-group"><label for="group_crest_url">団章（ヘッダー/フッター）</label><input type="text" id="group_crest_url" name="group_crest_url" placeholder="https://..."></div>
      <div class="two-col">
        <div class="form-group"><label for="unit_beaver_logo_url">ビーバー 隊章（ロゴ）</label><input type="text" id="unit_beaver_logo_url" name="unit_beaver_logo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_cub_logo_url">カブ 隊章（ロゴ）</label><input type="text" id="unit_cub_logo_url" name="unit_cub_logo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_boy_logo_url">ボーイ 隊章（ロゴ）</label><input type="text" id="unit_boy_logo_url" name="unit_boy_logo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_venture_logo_url">ベンチャー 隊章（ロゴ）</label><input type="text" id="unit_venture_logo_url" name="unit_venture_logo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_rover_logo_url">ローバー 隊章（ロゴ）</label><input type="text" id="unit_rover_logo_url" name="unit_rover_logo_url" placeholder="https://..."></div>
      </div>

      <h2>各隊 リーダー写真・メッセージ</h2>
      <h3>ビーバー</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_beaver_leader_photo_url">リーダー写真URL</label><input type="text" id="unit_beaver_leader_photo_url" name="unit_beaver_leader_photo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_beaver_leader_message">メッセージ</label><textarea id="unit_beaver_leader_message" name="unit_beaver_leader_message" rows="3" placeholder="メッセージ"></textarea></div>
      </div>
      <h3>カブ</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_cub_leader_photo_url">リーダー写真URL</label><input type="text" id="unit_cub_leader_photo_url" name="unit_cub_leader_photo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_cub_leader_message">メッセージ</label><textarea id="unit_cub_leader_message" name="unit_cub_leader_message" rows="3" placeholder="メッセージ"></textarea></div>
      </div>
      <h3>ボーイ</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_boy_leader_photo_url">リーダー写真URL</label><input type="text" id="unit_boy_leader_photo_url" name="unit_boy_leader_photo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_boy_leader_message">メッセージ</label><textarea id="unit_boy_leader_message" name="unit_boy_leader_message" rows="3" placeholder="メッセージ"></textarea></div>
      </div>
      <h3>ベンチャー</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_venture_leader_photo_url">リーダー写真URL</label><input type="text" id="unit_venture_leader_photo_url" name="unit_venture_leader_photo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_venture_leader_message">メッセージ</label><textarea id="unit_venture_leader_message" name="unit_venture_leader_message" rows="3" placeholder="メッセージ"></textarea></div>
      </div>
      <h3>ローバー</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_rover_leader_photo_url">リーダー写真URL</label><input type="text" id="unit_rover_leader_photo_url" name="unit_rover_leader_photo_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_rover_leader_message">メッセージ</label><textarea id="unit_rover_leader_message" name="unit_rover_leader_message" rows="3" placeholder="メッセージ"></textarea></div>
      </div>

      <h2>各隊 ギャラリー画像URL（最大4枚）</h2>
      <h3>ビーバー</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_beaver_gallery_img_1_url">画像1</label><input type="text" id="unit_beaver_gallery_img_1_url" name="unit_beaver_gallery_img_1_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_beaver_gallery_img_2_url">画像2</label><input type="text" id="unit_beaver_gallery_img_2_url" name="unit_beaver_gallery_img_2_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_beaver_gallery_img_3_url">画像3</label><input type="text" id="unit_beaver_gallery_img_3_url" name="unit_beaver_gallery_img_3_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_beaver_gallery_img_4_url">画像4</label><input type="text" id="unit_beaver_gallery_img_4_url" name="unit_beaver_gallery_img_4_url" placeholder="https://..."></div>
      </div>
      <h3>カブ</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_cub_gallery_img_1_url">画像1</label><input type="text" id="unit_cub_gallery_img_1_url" name="unit_cub_gallery_img_1_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_cub_gallery_img_2_url">画像2</label><input type="text" id="unit_cub_gallery_img_2_url" name="unit_cub_gallery_img_2_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_cub_gallery_img_3_url">画像3</label><input type="text" id="unit_cub_gallery_img_3_url" name="unit_cub_gallery_img_3_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_cub_gallery_img_4_url">画像4</label><input type="text" id="unit_cub_gallery_img_4_url" name="unit_cub_gallery_img_4_url" placeholder="https://..."></div>
      </div>
      <h3>ボーイ</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_boy_gallery_img_1_url">画像1</label><input type="text" id="unit_boy_gallery_img_1_url" name="unit_boy_gallery_img_1_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_boy_gallery_img_2_url">画像2</label><input type="text" id="unit_boy_gallery_img_2_url" name="unit_boy_gallery_img_2_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_boy_gallery_img_3_url">画像3</label><input type="text" id="unit_boy_gallery_img_3_url" name="unit_boy_gallery_img_3_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_boy_gallery_img_4_url">画像4</label><input type="text" id="unit_boy_gallery_img_4_url" name="unit_boy_gallery_img_4_url" placeholder="https://..."></div>
      </div>
      <h3>ベンチャー</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_venture_gallery_img_1_url">画像1</label><input type="text" id="unit_venture_gallery_img_1_url" name="unit_venture_gallery_img_1_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_venture_gallery_img_2_url">画像2</label><input type="text" id="unit_venture_gallery_img_2_url" name="unit_venture_gallery_img_2_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_venture_gallery_img_3_url">画像3</label><input type="text" id="unit_venture_gallery_img_3_url" name="unit_venture_gallery_img_3_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_venture_gallery_img_4_url">画像4</label><input type="text" id="unit_venture_gallery_img_4_url" name="unit_venture_gallery_img_4_url" placeholder="https://..."></div>
      </div>
      <h3>ローバー</h3>
      <div class="two-col">
        <div class="form-group"><label for="unit_rover_gallery_img_1_url">画像1</label><input type="text" id="unit_rover_gallery_img_1_url" name="unit_rover_gallery_img_1_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_rover_gallery_img_2_url">画像2</label><input type="text" id="unit_rover_gallery_img_2_url" name="unit_rover_gallery_img_2_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_rover_gallery_img_3_url">画像3</label><input type="text" id="unit_rover_gallery_img_3_url" name="unit_rover_gallery_img_3_url" placeholder="https://..."></div>
        <div class="form-group"><label for="unit_rover_gallery_img_4_url">画像4</label><input type="text" id="unit_rover_gallery_img_4_url" name="unit_rover_gallery_img_4_url" placeholder="https://..."></div>
      </div>

      <div class="form-actions">
        <button type="submit">保存</button>
        <a href="dashboard.html"><button type="button">キャンセル</button></a>
      </div>
      <p id="save-message" class="success-message" style="display:none;">保存しました</p>
      <p id="error-message" class="error-message"></p>
    </form>
  </div>

  <script>
    async function ensureLoggedIn() {
      try {
        const r = await fetch('/api/session');
        const d = await r.json();
        if (!d.loggedIn) { window.location.href = '/admin/login.html'; }
      } catch { window.location.href = '/admin/login.html'; }
    }

    function fillForm(settings) {
      const ids = Array.from(document.querySelectorAll('#branding-form input, #branding-form textarea')).map(i => i.id);
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = settings[id] || '';
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await ensureLoggedIn();
      try {
        const res = await fetch('/api/settings');
        const settings = await res.json();
        fillForm(settings);
      } catch (e) {
        document.getElementById('error-message').textContent = '設定の読み込みに失敗しました';
      }

      document.getElementById('branding-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const errEl = document.getElementById('error-message');
        const okEl = document.getElementById('save-message');
        errEl.textContent = '';
        okEl.style.display = 'none';

        const payload = {};
        document.querySelectorAll('#branding-form input, #branding-form textarea').forEach(input => {
          if (input.name) payload[input.name] = input.value.trim();
        });
        try {
          const res = await fetch('/api/settings', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
          if (!res.ok) throw new Error('保存に失敗しました');
          okEl.style.display = 'block';
          setTimeout(() => okEl.style.display = 'none', 1800);
        } catch (e) {
          errEl.textContent = e.message || '保存に失敗しました';
        }
      });

      document.getElementById('logout-button').addEventListener('click', async () => {
        try { await fetch('/api/logout', { method: 'POST' }); window.location.href = '/admin/login.html'; }
        catch { alert('ログアウトに失敗しました'); }
      });
    });
  </script>
</body>
</html>

